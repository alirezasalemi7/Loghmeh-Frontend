
variables:
 DOCKER_HOST: tcp://docker:2375/
 DOCKER_DRIVER: overlay2
 KUBE_CONFIG: YXBpVmVyc2lvbjogdjEKa2luZDogQ29uZmlnCnByZWZlcmVuY2VzOiB7fQoKIyBEZWZpbmUgdGhlIGNsdXN0ZXIKY2x1c3RlcnM6Ci0gY2x1c3RlcjoKICAgIGNlcnRpZmljYXRlLWF1dGhvcml0eS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VONVJFTkRRV0pEWjBGM1NVSkJaMGxDUVVSQlRrSm5hM0ZvYTJsSE9YY3dRa0ZSYzBaQlJFRldUVkpOZDBWUldVUldVVkZFUlhkd2NtUlhTbXdLWTIwMWJHUkhWbnBOUWpSWVJGUkpkMDFFVlhkTlZFVjZUVVJyTVU5V2IxaEVWRTEzVFVSUmVVOVVSWHBOUkdzeFQxWnZkMFpVUlZSTlFrVkhRVEZWUlFwQmVFMUxZVE5XYVZwWVNuVmFXRkpzWTNwRFEwRlRTWGRFVVZsS1MyOWFTV2gyWTA1QlVVVkNRbEZCUkdkblJWQkJSRU5EUVZGdlEyZG5SVUpCVGxkeUNqZ3dLMFJ5YUZaMlFrbHFXbWR2VVZKQmNtMVdhbmRhT0RjMWIwbDRRbVF6U0hvdlFVUnhNVGhUYnpCbU9FOHhRV2RtZUZBeE4waHNUREpzTjA1UVpWY0thRWxWUjFsNU1WVjZTblZFYVRCeWFuRlZaV3Q2ZVcxbFRHOXVkMnQzWkVaMVkwUlBObWRTZEVkb2JqZHlRaTh6ZDBWclNqUTNPWGRNSzBwU2RGZ3pTd3BTVkVReE5qRTFkRUZqUTNWNVFubG9ialJVVUZwWVZYUlBUemxvVUVrcmVWUm9TR0l5V1V4UlJrVTNaazVWZUdaclZ6aE9aRWQwYm1KblpuaG1XSFkzQ25aMU1WaE9SRXBUVTFCRlMwbFBaRlp6VkVoR05XVmFTa3BpY0N0V05tNVJLemhtVDNjNGJWTm9hWFpvY0hSRU5URkhiSGxuT0ZsMGIwOW5jQ3RuZHpZS2RrSndaR2w0ZEhoeUwxZzVXbTFHZUhaVFltWmtXVkowZDBVMVJUZFpaRTVhVTJkV2RYUjJVWHBvZVZSVWNqUk1VMDV5WVZKRFNUZFZTMngzUVdkamRRcFJaVEZuYURnelNqRktWa2RaVHk5c1dtbHpRMEYzUlVGQllVMXFUVU5GZDBSbldVUldVakJRUVZGSUwwSkJVVVJCWjB0clRVRTRSMEV4VldSRmQwVkNDaTkzVVVaTlFVMUNRV1k0ZDBSUldVcExiMXBKYUhaalRrRlJSVXhDVVVGRVoyZEZRa0ZMZGtsdGNubzVURXQwZUdKWWRHTnFORzlhTmxCYWNFbExjVkFLVmtOMlRtSjRVbXh2Vml0bU5GQm5iRXhDYmxKaVNrVXdXVmN2TDNRd1RHZHFjR1pWVFV3MVpGTm1NVEprV2k5SWFFRklPVXRqYWs1b01UZ3pSelp1VlFwWmJFUXJZbXg0Y1dvNEsyMUJVMUZqY3k5QlNsWnhLM0ZVSzFNNWNTdFFZMXBZUlZSNlkyVkJTSEZtVUZkbVZURmxUMFJVWWpoM09YQTFhaXR6YVVjeUNqVmFkMFpHYjIxVlNHTkpaRWxKZW14cVExRXZTSEJKWW5wbFUxaG1aMEZhU0dkdFlXbEZOR1ZFU1dKcVJUUTVkV2t4VlVneVlsbEdWRk5wUm5oemNDOEtibWRyVkhwSWMwRXhUa1pXYTFNd01tTkZlRmRSVm1Jek5ERlZUMXBZYkRaV1UxSlVRVU5zVTBsMVRrOVVOMUJVUjI0NGJYVkVaSGgxVEhSaE5UZE1TUW94U0hkUGVXZHhXR3BHWVVKRE1GQnBaMnBSZG5Rd2NXcFJkR2QwYm1GVFMwMUhOMVJNUlRrcmJFcHFhekZPYVVwMVpHOWFOek5ETHpSS05EMEtMUzB0TFMxRlRrUWdRMFZTVkVsR1NVTkJWRVV0TFMwdExRbz0KCiAgICBzZXJ2ZXI6IGh0dHBzOi8vMTg1LjE2Ni4xMDUuNjo2NDQzCiAgbmFtZTogbXktY2x1c3RlcgoKIyBEZWZpbmUgdGhlIHVzZXIKdXNlcnM6Ci0gbmFtZTogYWxpcmV6YS1yZXphLW5zLXVzZXIKICB1c2VyOgogICAgYXMtdXNlci1leHRyYToge30KICAgIGNsaWVudC1rZXktZGF0YTogTFMwdExTMUNSVWRKVGlCRFJWSlVTVVpKUTBGVVJTMHRMUzB0Q2sxSlNVTjVSRU5EUVdKRFowRjNTVUpCWjBsQ1FVUkJUa0puYTNGb2EybEhPWGN3UWtGUmMwWkJSRUZXVFZKTmQwVlJXVVJXVVZGRVJYZHdjbVJYU213S1kyMDFiR1JIVm5wTlFqUllSRlJKZDAxRVZYZE5WRVY2VFVSck1VOVdiMWhFVkUxM1RVUlJlVTlVUlhwTlJHc3hUMVp2ZDBaVVJWUk5Ra1ZIUVRGVlJRcEJlRTFMWVROV2FWcFlTblZhV0ZKc1kzcERRMEZUU1hkRVVWbEtTMjlhU1doMlkwNUJVVVZDUWxGQlJHZG5SVkJCUkVORFFWRnZRMmRuUlVKQlRsZHlDamd3SzBSeWFGWjJRa2xxV21kdlVWSkJjbTFXYW5kYU9EYzFiMGw0UW1RelNIb3ZRVVJ4TVRoVGJ6Qm1PRTh4UVdkbWVGQXhOMGhzVERKc04wNVFaVmNLYUVsVlIxbDVNVlY2U25WRWFUQnlhbkZWWld0NmVXMWxURzl1ZDJ0M1pFWjFZMFJQTm1kU2RFZG9iamR5UWk4emQwVnJTalEzT1hkTUswcFNkRmd6U3dwU1ZFUXhOakUxZEVGalEzVjVRbmxvYmpSVVVGcFlWWFJQVHpsb1VFa3JlVlJvU0dJeVdVeFJSa1UzWms1VmVHWnJWemhPWkVkMGJtSm5abmhtV0hZM0NuWjFNVmhPUkVwVFUxQkZTMGxQWkZaelZFaEdOV1ZhU2twaWNDdFdObTVSS3pobVQzYzRiVk5vYVhab2NIUkVOVEZIYkhsbk9GbDBiMDluY0N0bmR6WUtka0p3WkdsNGRIaHlMMWc1V20xR2VIWlRZbVprV1ZKMGQwVTFSVGRaWkU1YVUyZFdkWFIyVVhwb2VWUlVjalJNVTA1eVlWSkRTVGRWUzJ4M1FXZGpkUXBSWlRGbmFEZ3pTakZLVmtkWlR5OXNXbWx6UTBGM1JVRkJZVTFxVFVORmQwUm5XVVJXVWpCUVFWRklMMEpCVVVSQlowdHJUVUU0UjBFeFZXUkZkMFZDQ2k5M1VVWk5RVTFDUVdZNGQwUlJXVXBMYjFwSmFIWmpUa0ZSUlV4Q1VVRkVaMmRGUWtGTGRrbHRjbm81VEV0MGVHSllkR05xTkc5YU5sQmFjRWxMY1ZBS1ZrTjJUbUo0VW14dlZpdG1ORkJuYkV4Q2JsSmlTa1V3V1ZjdkwzUXdUR2RxY0daVlRVdzFaRk5tTVRKa1dpOUlhRUZJT1V0amFrNW9NVGd6UnpadVZRcFpiRVFyWW14NGNXbzRLMjFCVTFGamN5OUJTbFp4SzNGVUsxTTVjU3RRWTFwWVJWUjZZMlZCU0hGbVVGZG1WVEZsVDBSVVlqaDNPWEExYWl0emFVY3lDalZhZDBaR2IyMVZTR05KWkVsSmVteHFRMUV2U0hCSllucGxVMWhtWjBGYVNHZHRZV2xGTkdWRVNXSnFSVFE1ZFdreFZVZ3lZbGxHVkZOcFJuaHpjQzhLYm1kclZIcEljMEV4VGtaV2ExTXdNbU5GZUZkUlZtSXpOREZWVDFwWWJEWldVMUpVUVVOc1UwbDFUazlVTjFCVVIyNDRiWFZFWkhoMVRIUmhOVGRNU1FveFNIZFBlV2R4V0dwR1lVSkRNRkJwWjJwUmRuUXdjV3BSZEdkMGJtRlRTMDFITjFSTVJUa3JiRXBxYXpGT2FVcDFaRzlhTnpOREx6UktORDBLTFMwdExTMUZUa1FnUTBWU1ZFbEdTVU5CVkVVdExTMHRMUW89CiAgICB0b2tlbjogZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkluQm5VRTlCTURreGVtaERlRk56VVhaM2NHRlNXRnBXYVV3dGIwUTRiVzh4UlhoVlNWQnRiamR1WVVFaWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUpoYkdseVpYcGhMWEpsZW1FdGJuTWlMQ0pyZFdKbGNtNWxkR1Z6TG1sdkwzTmxjblpwWTJWaFkyTnZkVzUwTDNObFkzSmxkQzV1WVcxbElqb2lZV3hwY21WNllTMXlaWHBoTFc1ekxYVnpaWEl0ZEc5clpXNHRhamQ0TW1JaUxDSnJkV0psY201bGRHVnpMbWx2TDNObGNuWnBZMlZoWTJOdmRXNTBMM05sY25acFkyVXRZV05qYjNWdWRDNXVZVzFsSWpvaVlXeHBjbVY2WVMxeVpYcGhMVzV6TFhWelpYSWlMQ0pyZFdKbGNtNWxkR1Z6TG1sdkwzTmxjblpwWTJWaFkyTnZkVzUwTDNObGNuWnBZMlV0WVdOamIzVnVkQzUxYVdRaU9pSTFNemN3TUdVM01DMHhaR0UyTFRRd1pEZ3RPR1poT0MxaE56UTVNek5oTmpnNE1XVWlMQ0p6ZFdJaU9pSnplWE4wWlcwNmMyVnlkbWxqWldGalkyOTFiblE2WVd4cGNtVjZZUzF5WlhwaExXNXpPbUZzYVhKbGVtRXRjbVY2WVMxdWN5MTFjMlZ5SW4wLlV6Yjd3YVRGc1oyRDNieDR4T3gycFZyVVQyaENVbVo2TTJGNm9KZ1NmZnQxQjVSZFRwWXlUMHJGTVdGT1ctSGY3NkNKektPNzVQY25HY3loaWllVDRNVVEybnMwcy1QUEd2d3FZSUluZXNEcURTekpJVHBIeHd4cW1yaWh2TWpSNFlVVUhFZkVsdGhlSDlwM083a09rU1BiVnNSZEtsRENaaUxsWVI2dktIVVNmWmZHODA1dDc3NUgzSm52X2ZPNXdNODFSMHR4eHQ1RlFZbW80c2Vob2RXTWRDWEZZNE1aNVlZV0h1WlJHYkR3bFg3TDIxdEhCMXQ3Vmp4NmhtYmxPQmdUalJ0Z0szYVhuWkZIUV9JNmFZV1R4R0VBV2xXeWdiVUN3R05ka0ZSVTl3VFJUaEU1SlVJWFdYVVBrSDFMc2JIZDFWZEhZRl9GamdmT1FaRURxUQoKIyBEZWZpbmUgdGhlIGNvbnRleHQ6IGxpbmtpbmcgYSB1c2VyIHRvIGEgY2x1c3Rlcgpjb250ZXh0czoKLSBjb250ZXh0OgogICAgY2x1c3RlcjogbXktY2x1c3RlcgogICAgbmFtZXNwYWNlOiBhbGlyZXphLXJlemEtbnMKICAgIHVzZXI6IGFsaXJlemEtcmV6YS1ucy11c2VyCiAgbmFtZTogYWxpcmV6YS1yZXphLW5zCgojIERlZmluZSBjdXJyZW50IGNvbnRleHQKY3VycmVudC1jb250ZXh0OiBhbGlyZXphLXJlemEtbnM=

services:
 - docker:18-dind

stages:
 - build
 - deploy

docker_build:
#  only:
#   - master      
 stage: build
 image: docker:18-git
 before_script: 
  - docker login --username alirezasalemi --password 7c429978-fa6b-4ca4-8815-b705a47a81fb
 script:
  - docker build -t alirezasalemi/loghmeh-gui:$CI_COMMIT_SHORT_SHA -t alirezasalemi/loghmeh-gui:latest ./
  - docker push alirezasalemi/loghmeh-gui:$CI_COMMIT_SHORT_SHA
  - docker push alirezasalemi/loghmeh-gui:$latest
   
kube_deploy:
#  only:
#   - master      
 stage: deploy
 image: registry.gitlab.com/gitlab-org/cluster-integration/helm-install-image/releases/2.16.6-kube-1.13.12:latest
 before_script:
  - echo -n $KUBE_CONFIG | base64 -d > ./config
 script:
  - kubectl rollout restart deployment loghmeh-gui-deployment
 

   
   
   